<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- <title >Chatbot</title> -->
        <title >Chatbot</title>
    
        <!-- showdown  for markup language  -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js"></script> -->
        
        <!-- Prism CSS -->
        <link href="../static/prism.css" rel="stylesheet" />





        <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
       
        <style>
            .container {
      max-width: calc(75vw - 75px);
      margin: 0 auto;
      padding: 20px;
      /* border: 1px solid #ccc; */
      border: 2px solid #f1aafa;
      border-radius: 10px;
      box-shadow: 0px 0px 13px #ccc;
      background-color: #fff;
      height: 879px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      position: relative;
    }
    .form-control:focus {
  border-color: #d75cfd;
  box-shadow: none;
}
     .left {
        display: inline;
      position: absolute;
      top: 3px;
      left: 7px;
      padding-left: 13px;
      padding-top: 5px;

       
  font-size: 18px;
  font-weight: bold;


    }

    .right {
      
      position: absolute;
      top: 40%;
      left: 15px;

    }
    .buttonn{
      display: inline-block;
      padding: 12px 24px;
      background-color: #e375f1;
      color: #fff;
      font-size: 18px;
      height: 110px;
      width: 174px;;
      font-weight: bold;
      text-align: center;
      text-decoration: none;
      border-radius: 6px;
      line-height: 1;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      padding-top: 40px;
      padding-left: 5px;
      padding-right: 7px;
      margin-right: 2px;

    }
    .buttonn:hover {
  background-color: #32d1c4;
}

.buttonn:active {
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
}

    
    #chatbox {
      max-height: 100%;
      overflow: auto;
    }
    
    #chat-form {
        
      display: flex;
      flex-direction: row;
      align-items: center;
      margin-top: 10px;
      
    }
    
    .form-group {
      flex: 1;
      margin-right: 10px;
      position: relative;
    }
    
    .form-group textarea {
      
     
      width: 100%;
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #ccc;
  resize: none;
  font-size: 16px;
  line-height: 1.2;
    }
    .form-group textarea:focus {
  outline: none;
  box-shadow: 0 0 5px #ccc;
}
    
    .form-group label {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      background-color: #fff;
      padding: 0 5px;
      font-size: 14px;
      transition: all 0.2s ease;
      pointer-events: none;
    }
    
    .form-group textarea:focus + label,
    .form-group textarea:not(:placeholder-shown) + label {
      transform: translateY(-85%);
      font-size: 12px;
    }
    
    .btn {
      cursor: pointer;
      background-color: #a900ff;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      transition: all 0.2s ease;
    }
    
    .btn:hover {
      background-color: #32d1c4;
    }
    
    .bot-message,
    .user-message {
      max-width: 98%;
      padding: 10px;
      border-radius: 10px;
      margin-top: 10px;
      align-self: flex-start;
    }
    
    .bot-message {
      background-color: #f0f0f0;
      align-self: flex-end;
      white-space: pre-wrap;
    }
    
    .user-message {
      background-color: #cce6ff;
      align-self: flex-start;
      white-space: pre-wrap;
    }
    
    .typing-indicator {
      margin-top: 10px;
    }
    
    .typing-indicator span {
      display: inline-block;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background-color: #ccc;
      margin: 0 5px;
      animation: typing 1s linear infinite;
    }
    
    @keyframes typing {
      0% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-5px);
      }
      100% {
        transform: translateY(0);
      }
    }
    #chat-form button {
      display: block;
      margin-top: 10px;
    }
    
    code {
        display: inline-block;
        max-width: 98%;
     
        border-radius: 4px;
        padding: 0.2em 0.4em;
        font-family: monospace;
        white-space: pre-wrap;
        word-wrap: break-word;
        border: 1px solid #ddd;
      } 
      pre {
      background-color: #f7f7f7;
      background-color: #f0d7ed;
      border-radius: 5px;
      color: #000000;
      font-family: Consolas, 'Courier New', monospace;
      padding: 10px;
      overflow: auto;
      white-space: pre-wrap;
     
    }

    @media only screen and  (max-width: 1450px) {

        .container {

            height: 550px;
            padding: 0px;
            margin: 9px  auto;
           
        }
       
        .form-group textarea {
            margin-left: 7px;
        }
        button{
            margin-right: 10px;
        }
        .bot-message,
        .user-message {
            margin-left: 7px;
        }

        

    }

        
        </style> 
    
       
    </head>
    <body>
      <!-- <pre><code class="language-css"> p{
        color:black;}
                    
      </code></pre> -->
        <h1 class="left">ChatGPT - ChatBot</h1>
        
        <!-- <a href="/question" class="right buttonn">Document Q-&-A</a> -->
                    
        <div class="container" >
            <div id="chatbox"  >
            </div>
            <form id="chat-form" >
                <div class="form-group">
                  
                   
                    <textarea type="text" class="form-control" rows="1" id="user-message" name="user_message"></textarea>
    
                </div>
                <button type="submit" class="btn btn-primary" style="border-bottom-width: 00px;margin-bottom: 25px;" >Send</button>
                
            </form>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
 
      const socket = io.connect('http://127.0.0.1:5000');

// get DOM elements
const chatBox = document.getElementById('chatbox');
const chatForm = document.getElementById('chat-form');
const userMessage = document.getElementById('user-message');

// function to add messages to chat box
function addMessage(message) {
  const p = document.createElement('p');
  p.innerHTML = message;
  chatBox.appendChild(p);21
}

// submit form and send message to server on submit
chatForm.addEventListener('submit', (event) => {
  event.preventDefault();
    //  Create element
    botMessageHTML = document.createElement('div');
  botMessageHTML.classList.add('bot-message');
  const message = userMessage.value.trim();
  if (message !== '') {
    // send message to server
    socket.emit('message', message);
    // add user message to chat box
    var userMessageHTML = '<div class="user-message">' + message + '</div>';
    $(userMessageHTML).appendTo('#chatbox');
    
     var typingIndicator = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
     $('#chatbox').append(typingIndicator); 
     scrollToBottom();
     // add typing indicator
    // clear message input
    userMessage.value = '';
    textarea.style.height = '50px';
  }
});
let count = 0;
let count2 =0;
 let para;
 let codeElement
// receive response from server through socket
socket.on('response', (message) => {
 
  // add bot message to chat box
  $('.typing-indicator').remove();
  if(message == "``" || message == "```"){
    count+=1;
    if(count == 1){
      para = document.createElement("pre");
    //  codeElement = document.createElement("code");
    //  codeElement.classList.add("language-python")
    // para.appendChild(codeElement);
        
    }
    
  }else if(count == 1){
    para.innerHTML+= message;
    $(botMessageHTML).append(para);
    scrollToBottom();
  }else if(count == 2){
   count = 0; 
    
  }else{
  
      botMessageHTML.innerHTML+=message;
      $(botMessageHTML).appendTo('#chatbox');
      scrollToBottom();
    }

  
  

});


function scrollToBottom() {
          const chatbox = document.getElementById("chatbox");
          chatbox.scrollTop = chatbox.scrollHeight;
        }

// JavaScript
const textarea = document.getElementById('user-message');

textarea.addEventListener('input', () => {
  const lines = textarea.value.split('\n').length;
  if (lines === 1) {
    textarea.style.height = '50px'; // set to minimum height
  } else {
    textarea.style.height = '100px'; // set to maximum height
  }
});

textarea.addEventListener('keydown', (event) => {
  if (event.keyCode === 13 && event.shiftKey) {
    // add a new line to the text area
    textarea.value += '\n';
    // adjust the height of the text area to fit the new line
    textarea.style.height = `${textarea.scrollHeight}px`;
    // prevent the form from submitting
    event.preventDefault();
  }
 
});


</script>

<script src="../static/prism.js"></script>
</body>
</html>